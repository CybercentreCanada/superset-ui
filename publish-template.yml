parameters:
  workingDirs: []

steps:
- ${{ each dir in parameters.workingDirs }}:
  - script: |
      PackageName=$(npm list --json --depth=0 --silent | sed -n 2p | cut -d '"' -f4)
      NewPackageVersion=$(npm list --json --depth=0 --silent | sed -n 3p | cut -d '"' -f4)
      echo "##vso[task.setvariable variable=PackageName;]$PackageName"
      echo "##vso[task.setvariable variable=NewPackageVersion;]$NewPackageVersion"
    diplayName: "Get package name and version"
  - task: Npm@1
    inputs:
      command: publish
      publishRegistry: useFeed
      publishFeed: Analytical Platform/analytical-platform
      workingDir: ${{ dir }}
    continueOnError: true
    displayName: "Publish package $(PackageName) $(NewPackageVersion)"
