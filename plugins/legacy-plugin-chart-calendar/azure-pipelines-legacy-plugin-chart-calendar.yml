trigger:
  paths:
    include:
      - 'plugins/legacy-plugin-chart-calendar*'
  branches:
    include:
      - cccs-*
      - feature/CLDN-*

pool:
  vmImage: 'ubuntu-latest'

variables:
  tag: '$(Build.BuildId)'
  - name: working-dir
    value: 'plugins/legacy-plugin-chart-calendar/'

stages:
- stage: Build_and_Publish_Npm_Artifact
  displayName: Build, package and publish npm artifacts.
  jobs:
  - job: BuildPublishNpmArtifact
    displayName: Build, package and publish npm artifacts.
    steps:
    - task: NodeTool@0
      inputs:
        versionSpec: '14.x'
      workingDirectory: $(working-dir)
    - script: |
        yarn install
      workingDirectory: $(working-dir)
      displayName: 'Install dependencies'
    - script: |
        yarn build
      workingDirectory: $(working-dir)
      displayName: 'Build packages'
  - job: PublishArtifactToFeedArtifact
    dependsOn: BuildPublishNpmArtifact
    steps:
    - task: Npm@1
      inputs:
        command: publish
        publishRegistry: useFeed
        publishFeed: Analytical Platform/analytical-platform
      workingDirectory: $(working-dir)
